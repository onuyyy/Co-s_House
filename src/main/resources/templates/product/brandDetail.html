<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title th:text="${brand != null ? brand.brandName + ' ë¸Œëœë“œ' : 'ë¸Œëœë“œ'}">ë¸Œëœë“œ</title>
    <link rel="stylesheet" th:href="@{/css/app.css}">
    <link rel="stylesheet" th:href="@{/css/main/header.css}">
    <style>
        :root {
            --page-width: 1120px;
            --gutter: 24px;
        }

        body.page {
            background: var(--color-bg);
        }

        .page-main {
            padding: 40px 0 120px;
        }

        .page-shell {
            max-width: var(--page-width);
            margin: 0 auto;
            padding: 0 var(--gutter);
            display: flex;
            flex-direction: column;
            gap: 32px;
        }

        .brand-hero {
            background: #fff;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            padding: 36px;
            display: grid;
            grid-template-columns: minmax(180px, 240px) 1fr;
            gap: 32px;
            position: relative;
        }

        .brand-hero::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(140deg, rgba(60, 157, 252, 0.12), rgba(17, 24, 39, 0));
            z-index: 0;
        }

        .brand-hero > * {
            position: relative;
            z-index: 1;
        }

        .brand-logo-box {
            width: 150px;
            height: 150px;
            border-radius: 24px;
            background: #fff;
            box-shadow: var(--shadow-md);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
        }

        .brand-logo-box img {
            max-width: 80%;
            max-height: 80%;
            object-fit: contain;
        }

        .brand-logo-placeholder {
            font-size: 54px;
            color: var(--color-primary);
        }

        .brand-meta {
            display: flex;
            flex-direction: column;
            gap: 18px;
        }

        .brand-name {
            margin: 0;
            font-size: 32px;
            font-weight: 800;
            color: var(--color-text);
        }

        .brand-description {
            margin: 0;
            font-size: 15px;
            line-height: 1.7;
            color: var(--color-muted);
            white-space: pre-line;
        }

        .brand-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
        }

        .stat-card {
            background: rgba(17, 24, 39, 0.04);
            border-radius: var(--radius-md);
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .stat-card strong {
            font-size: 20px;
            font-weight: 800;
            color: var(--color-text);
        }

        .stat-card span {
            font-size: 12px;
            color: var(--color-muted);
            letter-spacing: 0.06em;
            text-transform: uppercase;
        }

        .breadcrumb {
            font-size: 13px;
            color: var(--color-muted);
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .breadcrumb a {
            color: inherit;
            text-decoration: none;
        }

        .breadcrumb a:hover {
            color: var(--color-primary);
        }

        .brand-toolbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
        }

        .brand-toolbar h2 {
            margin: 0;
            font-size: 20px;
            font-weight: 600;
            color: var(--color-text);
        }

        .product-count {
            color: var(--color-primary);
            font-weight: 700;
            margin-left: 8px;
            font-size: 15px;
        }

        .sort-select {
            height: 44px;
            border-radius: var(--radius-md);
            border: 1px solid var(--color-border);
            padding: 0 14px;
            font-size: 14px;
            background: #fff;
            cursor: pointer;
        }

        .sort-select:focus {
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(60, 157, 252, 0.18);
            outline: none;
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 20px;
        }

        .product-card {
            background: #fff;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.18s ease, box-shadow 0.18s ease;
            display: flex;
            flex-direction: column;
        }

        .product-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .product-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: rgba(17, 24, 39, 0.05);
        }

        .product-body {
            padding: 18px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            flex: 1;
        }

        .product-title {
            margin: 0;
            font-size: 16px;
            font-weight: 700;
            color: var(--color-text);
            line-height: 1.4;
            height: 44px;
            overflow: hidden;
        }

        .price-row {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 8px;
        }

        .price-current {
            font-size: 18px;
            font-weight: 800;
            color: var(--color-text);
        }

        .price-current.discounted {
            color: var(--color-error);
        }

        .price-original {
            font-size: 13px;
            color: var(--color-muted);
            text-decoration: line-through;
        }

        .price-badge {
            font-size: 12px;
            font-weight: 700;
            color: #fff;
            background: var(--color-error);
            padding: 4px 8px;
            border-radius: 999px;
        }

        .rating-row {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            color: var(--color-muted);
        }

        .rating-stars {
            position: relative;
            display: inline-flex;
            font-size: 16px;
            color: #d1d5db;
        }

        .rating-stars::before,
        .rating-stars::after {
            content: "â˜…â˜…â˜…â˜…â˜…";
        }

        .rating-stars::after {
            position: absolute;
            inset: 0;
            overflow: hidden;
            white-space: nowrap;
            color: #fbbf24;
            width: calc((var(--rating, 0) / 5) * 100%);
        }

        .empty-state {
            padding: 80px 20px;
            text-align: center;
            background: #fff;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            color: var(--color-muted);
        }

        .empty-state strong {
            display: block;
            font-size: 18px;
            color: var(--color-text);
            margin-bottom: 8px;
        }

        @media (max-width: 980px) {
            .brand-hero {
                grid-template-columns: 1fr;
                text-align: center;
            }

            .brand-meta {
                align-items: center;
            }

            .brand-toolbar {
                flex-direction: column;
                align-items: flex-start;
            }
        }

        @media (max-width: 640px) {
            .page-main {
                padding: 24px 0 80px;
            }

            .brand-hero {
                padding: 24px;
            }

            .brand-name {
                font-size: 26px;
            }

            .product-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
        }
    </style>
</head>
<body class="page font-body">
<div th:replace="~{fragments/layout :: header}"></div>

<main class="page-main">
    <div class="page-shell">
        <nav class="breadcrumb" aria-label="ë¸Œëœë“œ ìœ„ì¹˜">
            <a th:href="@{/}">í™ˆ</a>
            <span aria-hidden="true">/</span>
            <a th:href="@{/brands}">ë¸Œëœë“œ</a>
            <span aria-hidden="true">/</span>
            <strong th:text="${brand != null ? brand.brandName : 'ë¸Œëœë“œ'}">ë¸Œëœë“œ</strong>
        </nav>

        <section class="brand-hero" th:if="${brand != null}">
            <div class="brand-logo-box" role="img" th:attr="aria-label=${brand.brandName} + ' ë¡œê³ '">
                <img th:if="${brand.logoUrl != null and !brand.logoUrl.isEmpty()}"
                     th:src="${#strings.startsWith(brand.logoUrl, 'http') ? brand.logoUrl : (#strings.startsWith(brand.logoUrl, '/') ? brand.logoUrl : '/' + brand.logoUrl)}"
                     th:alt="${brand.brandName} + ' ë¡œê³ '">
                <div th:unless="${brand.logoUrl != null and !brand.logoUrl.isEmpty()}" class="brand-logo-placeholder">ğŸª</div>
            </div>

            <div class="brand-meta">
                <div>
                    <h1 class="brand-name" th:text="${brand.brandName}">ë¸Œëœë“œëª…</h1>
                    <p class="brand-description"
                       th:text="${brand.brandDescription != null && !#strings.isEmpty(brand.brandDescription) ? brand.brandDescription : 'ì½”ë”©ì˜ ì§‘ê³¼ í•¨ê»˜í•˜ëŠ” íŒŒíŠ¸ë„ˆ ë¸Œëœë“œì…ë‹ˆë‹¤.'}">
                        ë¸Œëœë“œ ì„¤ëª…
                    </p>
                </div>

                <div class="brand-stats">
                    <div class="stat-card">
                        <strong th:text="${products != null ? products.size() : 0}">0</strong>
                        <span>Products</span>
                    </div>
                    <div class="stat-card">
                        <strong th:text="${products != null && !#lists.isEmpty(products.?[averageRating != null].![averageRating]) ? #numbers.formatDecimal(#aggregates.avg(products.?[averageRating != null].![averageRating]), 1, 1) : '0.0'}">0.0</strong>
                        <span>Rating</span>
                    </div>
                    <div class="stat-card">
                        <strong th:text="${products != null && !#lists.isEmpty(products.?[reviewCount != null].![reviewCount]) ? #numbers.formatInteger(#aggregates.sum(products.?[reviewCount != null].![reviewCount]), 0, 'COMMA') : '0'}">0</strong>
                        <span>Reviews</span>
                    </div>
                </div>
            </div>
        </section>

        <section class="brand-toolbar">
            <h2>
                ì „ì²´ ìƒí’ˆ
                <span class="product-count" th:text="${products != null ? '(' + products.size() + 'ê°œ)' : '(0ê°œ)'}">(0ê°œ)</span>
            </h2>
            <select id="sort-select" class="sort-select" aria-label="ìƒí’ˆ ì •ë ¬" onchange="handleSortChange(this.value)">
                <option value="default">ê¸°ë³¸ìˆœ</option>
                <option value="price-asc">ë‚®ì€ ê°€ê²©ìˆœ</option>
                <option value="price-desc">ë†’ì€ ê°€ê²©ìˆœ</option>
                <option value="rating-desc">í‰ì  ë†’ì€ìˆœ</option>
            </select>
        </section>

        <section th:if="${products != null and !products.isEmpty()}" class="product-grid" role="list">
            <article class="product-card" role="listitem" th:each="product : ${products}"
                     th:onclick="|window.location.href='/product/' + ${product.productId}|"
                     th:attr="aria-label=${product.productTitle}">
                <img th:if="${product.mainImageUrl != null}" th:src="${product.mainImageUrl}" th:alt="${product.productTitle}">
                <div th:unless="${product.mainImageUrl != null}" style="display:flex;align-items:center;justify-content:center;height:200px;font-size:48px;color:rgba(17,24,39,0.25);">ğŸ“¦</div>
                <div class="product-body">
                    <h3 class="product-title" th:text="${product.productTitle}">ìƒí’ˆëª…</h3>
                    <div class="price-row">
                        <span th:if="${product.salePrice != null and product.originalPrice != null and product.salePrice < product.originalPrice}"
                              class="price-badge"
                              th:text="${#numbers.formatDecimal((1 - (product.salePrice / product.originalPrice)) * 100, 0, 0)} + '%'"></span>
                        <span class="price-current"
                              th:classappend="${product.salePrice != null and product.originalPrice != null and product.salePrice < product.originalPrice} ? ' discounted' : ''"
                              th:text="${#numbers.formatInteger((product.salePrice != null ? product.salePrice : product.originalPrice), 0, 'COMMA')} + 'ì›'">0ì›</span>
                        <span th:if="${product.salePrice != null and product.originalPrice != null and product.salePrice < product.originalPrice}"
                              class="price-original"
                              th:text="${#numbers.formatInteger(product.originalPrice, 0, 'COMMA')} + 'ì›'">0ì›</span>
                    </div>
                    <div class="rating-row">
                        <span class="rating-stars" th:if="${product.averageRating != null}" th:style="${'--rating:' + product.averageRating}"></span>
                        <span th:if="${product.averageRating != null}" th:text="${#numbers.formatDecimal(product.averageRating, 1, 1)}">0.0</span>
                        <span th:text="${product.reviewCount != null ? '(' + product.reviewCount + 'ê°œ)' : 'ë¦¬ë·° ì¤€ë¹„ì¤‘'}">ë¦¬ë·°</span>
                    </div>
                </div>
            </article>
        </section>

        <section th:if="${products == null or products.isEmpty()}" class="empty-state" role="status">
            <strong>ë“±ë¡ëœ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</strong>
            ìµœì‹  ìƒí’ˆì´ ì¤€ë¹„ë˜ëŠ” ëŒ€ë¡œ ì•Œë ¤ë“œë¦´ê²Œìš”.
        </section>
    </div>
</main>

<div th:replace="~{fragments/layout :: footer}"></div>

<script th:inline="javascript">
    /*<![CDATA[*/
    const currentBrandId = /*[[${brand != null ? brand.brandId : null}]]*/ null;

    function handleSortChange(sortType) {
        if (!currentBrandId) {
            return;
        }
        let target = `/brands/${currentBrandId}`;
        if (sortType === 'price-asc') {
            target += '/price-asc';
        } else if (sortType === 'price-desc') {
            target += '/price-desc';
        } else if (sortType === 'rating-desc') {
            target += '/rating-desc';
        }
        window.location.href = target;
    }

    document.addEventListener('DOMContentLoaded', () => {
        const select = document.getElementById('sort-select');
        if (!select) return;
        const path = window.location.pathname;
        if (path.includes('/price-asc')) {
            select.value = 'price-asc';
        } else if (path.includes('/price-desc')) {
            select.value = 'price-desc';
        } else if (path.includes('/rating-desc')) {
            select.value = 'rating-desc';
        } else {
            select.value = 'default';
        }
    });
    /*]]>*/
</script>
</body>
</html>
