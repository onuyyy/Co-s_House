<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/layout :: head('코딩의 집 | 내 쿠폰')}"></head>

<body class="page font-body">
<header th:replace="~{fragments/layout :: header}"></header>
<main class="page-main coupon-main">
<div class="coupon-main__inner container">
    <h1>내 쿠폰함</h1>

    <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
    <div th:if="${error}" class="alert alert-error" th:text="${error}"></div>


    <div class="filter-actions" style="justify-content:flex-start; margin-bottom:12px; gap:12px;">
        <a class="btn-secondary" th:href="@{/mypage/coupons}">쿠폰 발급</a>
        <button type="button" class="btn-secondary" style="background:#2563eb; color:white; cursor:default;">내 쿠폰함</button>
    </div>

    <div th:if="${#lists.isEmpty(userCoupons)}" class="empty-state">
        보유한 쿠폰이 없습니다. 쿠폰 발급 페이지에서 쿠폰을 받아보세요.
    </div>

    <div th:if="${!#lists.isEmpty(userCoupons)}" class="coupon-list">
        <article class="coupon-card" th:each="item : ${userCoupons}">
            <div>
                <span class="badge"
                      th:classappend="${item.coupon.couponScope.name() == 'GLOBAL'} ? ' badge-global' :
                                       (${item.coupon.couponScope.name() == 'BRAND'} ? ' badge-brand' : ' badge-product')"
                      th:text="${item.coupon.couponScope.name() == 'GLOBAL' ? '전체' : (item.coupon.couponScope.name() == 'BRAND' ? '브랜드' : '상품전용')}">전체</span>
            </div>
            <div class="coupon-title" th:text="${item.coupon.couponTitle}">쿠폰 제목</div>
            <div class="coupon-meta" th:if="${item.coupon.brandName != null}" th:text="|브랜드: ${item.coupon.brandName}|">브랜드</div>
            <div class="coupon-meta" th:if="${item.coupon.productTitle != null}" th:text="|상품: ${item.coupon.productTitle}|">상품</div>
            <div class="coupon-body" th:text="${item.coupon.couponDescription}">설명</div>
            <div class="coupon-meta" th:if="${item.coupon.discountRate != null}" th:text="|할인율: ${item.coupon.discountRate}%|">할인율</div>
            <div class="coupon-meta" th:if="${item.coupon.discountAmount != null}" th:text="|할인금액: ${#numbers.formatDecimal(item.coupon.discountAmount, 0, 'COMMA', 0, 'POINT')}원|">할인금액</div>
            <div class="coupon-meta" th:if="${item.coupon.maxDiscountAmount != null}" th:text="|최대 ${#numbers.formatDecimal(item.coupon.maxDiscountAmount, 0, 'COMMA', 0, 'POINT')}원 할인|">최대 할인</div>
            <div class="coupon-meta" th:if="${item.coupon.minPurchaseAmount != null}" th:text="|최소 주문금액 ${#numbers.formatDecimal(item.coupon.minPurchaseAmount, 0, 'COMMA', 0, 'POINT')}원|">최소 금액</div>
            <div class="coupon-meta" th:text="|발급일: ${item.issuedAt != null ? #temporals.format(item.issuedAt, 'yyyy.MM.dd HH:mm') : '-'}|">발급일</div>
            <div class="coupon-footer">
                <span th:text="|사용 가능 기간: ${#temporals.format(item.coupon.startDate, 'yyyy.MM.dd')} ~ ${#temporals.format(item.coupon.expiredAt, 'yyyy.MM.dd')}|">기간</span>
                <span class="badge-usability"
                      th:classappend="${item.usable} ? ' usable' : (${item.expired} ? ' expired' : ' used')"
                      th:text="${item.usable} ? '사용 가능' : (${item.expired} ? '만료' : '사용 완료')">상태</span>
            </div>
        </article>
    </div>

    <div th:if="${page != null && page.totalPages > 1}" class="pagination">
        <span th:if="${page.first}" class="disabled">이전</span>
        <a th:if="${!page.first}" th:href="@{/mypage/coupons/mine(page=${page.number - 1})}">이전</a>

        <span th:each="i : ${#numbers.sequence(0, page.totalPages - 1)}"
              th:if="${page.totalPages <= 7 || (i >= page.number - 2 && i <= page.number + 2)}">
            <span th:if="${i == page.number}" th:text="${i + 1}" class="active"></span>
            <a th:if="${i != page.number}"
               th:text="${i + 1}" th:href="@{/mypage/coupons/mine(page=${i})}"></a>
        </span>

        <a th:if="${!page.last}" th:href="@{/mypage/coupons/mine(page=${page.number + 1})}">다음</a>
        <span th:if="${page.last}" class="disabled">다음</span>
    </div>
</div>
</main>
<footer th:replace="~{fragments/layout :: footer}"></footer>

<link rel="stylesheet" th:href="@{/css/sections.css}">
<link rel="stylesheet" th:href="@{/css/mypage/mycoupon.css}">
</body>
</html>
