<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/admin-layout}"
      lang="ko">
<head>
    <title>ì‚¬ìš©ì ìƒì„¸ì •ë³´</title>
</head>
<body>
    <!-- Content Header -->
    <div layout:fragment="content-header" class="content-header">
        <div>
            <div class="breadcrumb">
                <a href="/api/admin/users">ì‚¬ìš©ì ê´€ë¦¬</a> > ì‚¬ìš©ì ìƒì„¸ì •ë³´
            </div>
            <h2 style="color: #333; font-size: 24px; margin-top: 10px;">ì‚¬ìš©ì ìƒì„¸ì •ë³´</h2>
        </div>
        <div>
            <a href="/api/admin/users" class="btn btn-secondary">ëª©ë¡ìœ¼ë¡œ</a>
        </div>
    </div>

    <!-- Main Content -->
    <div layout:fragment="content">
        <!-- ì•Œë¦¼ ë©”ì‹œì§€ -->
        <div th:if="${param.success}" class="alert alert-success">
            ì‚¬ìš©ì ì •ë³´ê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.
        </div>
        <div th:if="${param.error}" class="alert alert-danger">
            <span th:text="${param.error}">ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</span>
        </div>

        <!-- ëª¨ë“œ ì„ íƒ ë²„íŠ¼ -->
        <div class="mode-selector">
            <button id="viewMode" class="mode-btn active" onclick="toggleMode('view')">ğŸ‘ï¸ ë³´ê¸° ëª¨ë“œ</button>
            <button id="editMode" class="mode-btn" onclick="toggleMode('edit')">âœï¸ ìˆ˜ì • ëª¨ë“œ</button>
        </div>

        <!-- ì‚¬ìš©ì ì •ë³´ (ì½ê¸° ì „ìš©) -->
        <div class="detail-card" id="viewSection">
            <div class="detail-card-header">
                <h3>ğŸ‘¤ ì‚¬ìš©ì ì •ë³´</h3>
            </div>
            <div class="detail-card-body">
                <div class="detail-grid">
                    <div class="detail-label">ì‚¬ìš©ì ID</div>
                    <div class="detail-value" th:text="${user.userId}">1</div>

                    <div class="detail-label">ì´ë¦„</div>
                    <div class="detail-value user-name" th:text="${user.userName}">ì‚¬ìš©ìëª…</div>

                    <div class="detail-label">ë‹‰ë„¤ì„</div>
                    <div class="detail-value" th:text="${user.userNickname}">ë‹‰ë„¤ì„</div>

                    <div class="detail-label">ì´ë©”ì¼</div>
                    <div class="detail-value email-display" th:text="${user.userEmail}">ì´ë©”ì¼</div>

                    <div class="detail-label">ì—­í• </div>
                    <div class="detail-value">
                        <span th:class="${user.admin ? 'role-badge admin-role' : 'role-badge user-role'}"
                              th:text="${user.userRoleName}">ì—­í• </span>
                    </div>

                    <div class="detail-label">ì£¼ì†Œ</div>
                    <div class="detail-value" th:text="${user.userAddress ?: 'ì •ë³´ ì—†ìŒ'}">ì£¼ì†Œ</div>

                    <div class="detail-label">ì—°ë½ì²˜</div>
                    <div class="detail-value" th:text="${user.userPhone ?: 'ì •ë³´ ì—†ìŒ'}">ì—°ë½ì²˜</div>

                    <div class="detail-label">ì†Œì…œ ë¡œê·¸ì¸</div>
                    <div class="detail-value" th:text="${user.socialProvider ?: 'ì¼ë°˜ íšŒì›'}">ì†Œì…œ ë¡œê·¸ì¸</div>

                    <div class="detail-label">ì†Œì…œ ID</div>
                    <div class="detail-value" th:text="${user.socialId ?: '-'}">ì†Œì…œ ID</div>

                    <div class="detail-label">ì•½ê´€ ë™ì˜</div>
                    <div class="detail-value">
                        <span th:class="${user.termsAgreed != null and user.termsAgreed ? 'status-badge status-active' : 'status-badge status-inactive'}"
                              th:text="${user.termsAgreed != null and user.termsAgreed ? 'ë™ì˜' : 'ë¯¸ë™ì˜'}">
                            ì•½ê´€ ë™ì˜
                        </span>
                    </div>

                    <div class="detail-label">ê°€ì…ì¼ì</div>
                    <div class="detail-value" th:text="${user.userCreatedAt != null ? #temporals.format(user.userCreatedAt, 'yyyy-MM-dd HH:mm') : '-'}">ê°€ì…ì¼ì</div>

                    <div class="detail-label">ìˆ˜ì •ì¼ì</div>
                    <div class="detail-value" th:text="${user.userUpdatedAt != null ? #temporals.format(user.userUpdatedAt, 'yyyy-MM-dd HH:mm') : '-'}">ìˆ˜ì •ì¼ì</div>
                </div>
            </div>
        </div>

        <!-- ì‚¬ìš©ì ìˆ˜ì • í¼ -->
        <div class="detail-card" id="editSection" style="display: none;">
            <div class="detail-card-header">
                <h3>âœï¸ ì‚¬ìš©ì ì •ë³´ ìˆ˜ì •</h3>
            </div>
            <div class="detail-card-body">
                <form th:action="@{/api/admin/users/{userId}/update(userId=${user.userId})}" method="post" class="user-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="userName" class="required">ì´ë¦„ *</label>
                            <input type="text" id="userName" name="userName" th:value="${user.userName}"
                                   class="form-control" required maxlength="50"
                                   placeholder="ì‚¬ìš©ì ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
                            <small class="form-text">í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤. (ìµœëŒ€ 50ì)</small>
                        </div>

                        <div class="form-group">
                            <label for="userNickname" class="required">ë‹‰ë„¤ì„ *</label>
                            <input type="text" id="userNickname" name="userNickname" th:value="${user.userNickname}"
                                   class="form-control" required maxlength="20"
                                   placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”">
                            <small class="form-text">í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤. (ìµœëŒ€ 20ì)</small>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="userEmail" class="required">ì´ë©”ì¼ *</label>
                            <input type="email" id="userEmail" name="userEmail" th:value="${user.userEmail}"
                                   class="form-control" required maxlength="255"
                                   placeholder="example@email.com">
                            <small class="form-text">í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤. ë¡œê·¸ì¸ IDë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.</small>
                        </div>

                        <div class="form-group">
                            <label for="userPhone">ì—°ë½ì²˜</label>
                            <input type="tel" id="userPhone" name="userPhone" th:value="${user.userPhone}"
                                   class="form-control" maxlength="20"
                                   placeholder="010-0000-0000">
                            <small class="form-text">íœ´ëŒ€í° ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</small>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="userAddress">ì£¼ì†Œ</label>
                            <textarea id="userAddress" name="userAddress" th:text="${user.userAddress}"
                                      class="form-control" rows="3" maxlength="200"
                                      placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                            <small class="form-text">ì‚¬ìš©ìì˜ ì£¼ì†Œ ì •ë³´ì…ë‹ˆë‹¤. (ìµœëŒ€ 200ì)</small>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group checkbox-group">
                            <label>
                                <input type="checkbox" name="termsAgreed" th:checked="${user.termsAgreed}">
                                <span class="checkbox-text">ì´ìš©ì•½ê´€ ë™ì˜</span>
                            </label>
                            <small class="form-text">ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€ì— ë™ì˜í•˜ëŠ”ì§€ ì„¤ì •í•©ë‹ˆë‹¤.</small>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">
                            <i class="icon">ğŸ’¾</i> ìˆ˜ì • ì €ì¥
                        </button>
                        <button type="button" class="btn btn-danger" onclick="deleteUser()">
                            <i class="icon">ğŸ—‘ï¸</i> ì‚¬ìš©ì ì‚­ì œ
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="toggleMode('view')">
                            <i class="icon">âŒ</i> ì·¨ì†Œ
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- ì½ê¸° ì „ìš© ëª¨ë“œ ë©”ì‹œì§€ -->
        <div class="readonly-message" id="readonlyMessage">
            <div class="readonly-icon">ğŸ‘ï¸</div>
            <div class="readonly-text">
                <strong>ì½ê¸° ì „ìš© ëª¨ë“œ</strong><br>
                í˜„ì¬ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤. ìˆ˜ì •ì´ í•„ìš”í•œ ê²½ìš° 'ìˆ˜ì • ëª¨ë“œ'ë¡œ ì „í™˜í•˜ì„¸ìš”.
            </div>
        </div>
    </div>

    <th:block layout:fragment="extra-css">
        <style>
            .mode-selector { display: flex; gap: 10px; margin-bottom: 20px; padding: 10px; background-color: #f8f9fa; border-radius: 8px; border: 1px solid #dee2e6; }
            .mode-btn { padding: 8px 16px; border: 1px solid #dee2e6; background-color: #ffffff; color: #6c757d; border-radius: 6px; cursor: pointer; transition: all 0.3s ease; font-size: 14px; font-weight: 500; }
            .mode-btn:hover { background-color: #e9ecef; color: #495057; }
            .mode-btn.active { background-color: #007bff; color: white; border-color: #007bff; }
            .detail-grid { display: grid; grid-template-columns: 150px 1fr; gap: 12px 20px; align-items: center; }
            .detail-label { font-weight: 600; color: #495057; background-color: #f8f9fa; padding: 8px 12px; border-radius: 6px; border: 1px solid #e9ecef; }
            .detail-value { background-color: #ffffff; padding: 8px 12px; border-radius: 6px; border: 1px solid #e9ecef; color: #212529; }
            .user-name { font-size: 1.1em; font-weight: 600; color: #007bff; }
            .email-display { font-family: monospace; font-size: 0.9em; }
            .role-badge { padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: bold; }
            .admin-role { background-color: #dc3545; color: white; }
            .user-role { background-color: #28a745; color: white; }
            .status-badge { padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; }
            .status-active { background-color: #28a745; color: white; }
            .status-inactive { background-color: #dc3545; color: white; }
            .user-form { max-width: 800px; }
            .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
            .form-row:has(.form-group:only-child) { grid-template-columns: 1fr; }
            .form-group { width: 100%; }
            .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; }
            .form-group label.required { color: #dc3545; }
            .form-control { width: 100%; padding: 10px 12px; border: 1px solid #ced4da; border-radius: 6px; font-size: 14px; transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out; }
            .form-control:focus { outline: 0; border-color: #80bdff; box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25); }
            .checkbox-group { display: flex; align-items: center; gap: 10px; }
            .checkbox-group label { display: flex; align-items: center; gap: 8px; font-weight: normal; cursor: pointer; padding: 8px 12px; background-color: #f8f9fa; border-radius: 6px; border: 1px solid #e9ecef; }
            .checkbox-text { font-weight: 500; color: #495057; }
            .form-text { display: block; margin-top: 5px; color: #6c757d; font-size: 12px; }
            .form-actions { display: flex; gap: 10px; margin-top: 30px; padding-top: 20px; border-top: 1px solid #e9ecef; }
            .readonly-message { display: flex; align-items: center; background-color: #e7f3ff; border: 1px solid #b8daff; border-radius: 8px; padding: 16px; margin-top: 20px; gap: 12px; }
            .readonly-icon { font-size: 24px; flex-shrink: 0; }
            .readonly-text { color: #004085; line-height: 1.5; }
            .alert { padding: 12px 16px; margin-bottom: 20px; border: 1px solid transparent; border-radius: 4px; }
            .alert-success { color: #155724; background-color: #d4edda; border-color: #c3e6cb; }
            .alert-danger { color: #721c24; background-color: #f8d7da; border-color: #f5c6cb; }
            .icon { margin-right: 5px; }
        </style>
    </th:block>

    <th:block layout:fragment="extra-scripts">
        <script>
            function toggleMode(mode) {
                const viewBtn = document.getElementById('viewMode');
                const editBtn = document.getElementById('editMode');
                const viewSection = document.getElementById('viewSection');
                const editSection = document.getElementById('editSection');
                const readonlyMessage = document.getElementById('readonlyMessage');

                if (mode === 'view') {
                    viewBtn.classList.add('active');
                    editBtn.classList.remove('active');
                    viewSection.style.display = 'block';
                    editSection.style.display = 'none';
                    readonlyMessage.style.display = 'flex';
                } else {
                    editBtn.classList.add('active');
                    viewBtn.classList.remove('active');
                    viewSection.style.display = 'none';
                    editSection.style.display = 'block';
                    readonlyMessage.style.display = 'none';
                }
            }

            function deleteUser() {
                if (confirm('ì •ë§ë¡œ ì´ ì‚¬ìš©ìë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì‚­ì œëœ ë°ì´í„°ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                    const form = document.createElement('form');
                    form.method = 'POST';
                    form.action = '/api/admin/users/' + [[${user.userId}]] + '/delete';
                    document.body.appendChild(form);
                    form.submit();
                }
            }
        </script>
    </th:block>
</body>
</html>