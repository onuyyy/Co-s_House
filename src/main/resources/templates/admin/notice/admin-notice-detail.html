<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/admin-layout}"
      lang="ko">
<head>
    <title>ê³µì§€ ìƒì„¸ì •ë³´</title>
    <link rel="stylesheet" th:href="@{/css/admin/admin-common.css}">
    <link rel="stylesheet" th:href="@{/css/admin/notice.css}">
</head>
<body>
<div layout:fragment="content-header" class="content-header">
    <h2 class="page-title">ê³µì§€ ìƒì„¸ì •ë³´</h2>
    <div class="header-actions">
        <a th:href="@{/api/admin/notices}" class="btn btn-secondary">ëª©ë¡ìœ¼ë¡œ</a>
    </div>
</div>

<div layout:fragment="content">
    <div th:if="${param.success}" class="alert alert-success">ê³µì§€ ì •ë³´ê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.</div>
    <div th:if="${param.error}" class="alert alert-danger" th:text="${param.error}">ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>
    <div th:if="${param.updated}" class="alert alert-success">ê³µì§€ê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.</div>

    <div class="mode-selector">
        <button id="viewMode" class="mode-btn active" onclick="toggleMode('view')">ğŸ‘ï¸ ë³´ê¸° ëª¨ë“œ</button>
        <button id="editMode" class="mode-btn" onclick="toggleMode('edit')">âœï¸ ìˆ˜ì • ëª¨ë“œ</button>
    </div>

    <!-- ì½ê¸° ì „ìš© -->
    <div class="notice-detail-card" id="viewSection">
        <h3>ğŸ“‹ ê³µì§€ ì •ë³´</h3>
        <div class="notice-detail-grid">
            <div class="notice-detail-label">ì œëª©</div>
            <div class="notice-detail-value" th:text="${notice.title}">ê³µì§€ ì œëª©</div>

            <div class="notice-detail-label">ì‘ì„±ì</div>
            <div class="notice-detail-value" th:text="${notice.writerName != null ? notice.writerName : 'ì•Œ ìˆ˜ ì—†ìŒ'}">ì‘ì„±ì</div>

            <div class="notice-detail-label">ì‘ì„±ì¼</div>
            <div class="notice-detail-value" th:text="${#temporals.format(notice.createTime, 'yyyy-MM-dd HH:mm')}">2024-01-01 12:00</div>

            <div class="notice-detail-label" th:if="${notice.updateTime != null}">ìˆ˜ì •ì¼</div>
            <div class="notice-detail-value" th:if="${notice.updateTime != null}" th:text="${#temporals.format(notice.updateTime, 'yyyy-MM-dd HH:mm')}">2024-01-01 12:00</div>
        </div>

        <div class="content-section">
            <div class="notice-detail-label">ë‚´ìš©</div>
            <div class="content-display" th:text="${notice.content}">ê³µì§€ ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
        </div>
    </div>

    <!-- ìˆ˜ì • í¼ -->
    <div class="notice-detail-card hidden" id="editSection">
        <h3>âœï¸ ê³µì§€ ì •ë³´ ìˆ˜ì •</h3>
        <form th:action="@{/api/admin/notices/{id}/update(id=${notice.noticeId})}" method="post">
            <div class="form-group">
                <label for="title">ì œëª© *</label>
                <input type="text" id="title" name="title" th:value="${notice.title}" class="form-control" required>
            </div>

            <div class="form-group">
                <label for="content">ë‚´ìš© *</label>
                <textarea id="content" name="content" th:text="${notice.content}" class="form-control content-textarea" required rows="10"></textarea>
            </div>

            <div class="notice-form-actions">
                <button type="submit" class="btn btn-primary">ğŸ’¾ ìˆ˜ì • ì €ì¥</button>
                <button type="button" class="btn btn-danger" onclick="deleteNotice()">ğŸ—‘ï¸ ì‚­ì œ</button>
                <button type="button" class="btn btn-secondary" onclick="toggleMode('view')">âŒ ì·¨ì†Œ</button>
            </div>
        </form>
    </div>

    <div class="readonly-message" id="readonlyMessage">
        <strong>ì½ê¸° ì „ìš© ëª¨ë“œ</strong><br>í˜„ì¬ ê³µì§€ ì •ë³´ ì¡°íšŒë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.
    </div>
</div>


<th:block layout:fragment="extra-scripts">
    <script>
        function toggleMode(mode) {
            const viewBtn = document.getElementById('viewMode');
            const editBtn = document.getElementById('editMode');
            const viewSection = document.getElementById('viewSection');
            const editSection = document.getElementById('editSection');
            const readonlyMessage = document.getElementById('readonlyMessage');

            if (mode === 'view') {
                viewBtn.classList.add('active');
                editBtn.classList.remove('active');
                viewSection.classList.remove('hidden');
                editSection.classList.add('hidden');
                readonlyMessage.style.display = 'block';
            } else {
                editBtn.classList.add('active');
                viewBtn.classList.remove('active');
                viewSection.classList.add('hidden');
                editSection.classList.remove('hidden');
                readonlyMessage.style.display = 'none';
            }
        }

        function deleteNotice() {
            if (confirm('ì •ë§ë¡œ ì´ ê³µì§€ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = '/api/admin/notices/' + [[${notice.noticeId}]] + '/delete';
                document.body.appendChild(form);
                form.submit();
            }
        }
    </script>
</th:block>
</body>
</html>