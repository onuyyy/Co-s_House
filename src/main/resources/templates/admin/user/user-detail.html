<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/admin-layout}"
      lang="ko">
<head>
    <title>ì‚¬ìš©ì ìƒì„¸ì •ë³´</title>
    <link rel="stylesheet" th:href="@{/css/admin/admin-common.css}">
    <link rel="stylesheet" th:href="@{/css/admin/user.css}">
</head>
<body>
    <!-- Content Header -->
    <div layout:fragment="content-header" class="content-header">
        <div>
            <div class="breadcrumb">
                <a href="/api/admin/users">ì‚¬ìš©ì ê´€ë¦¬</a> > ì‚¬ìš©ì ìƒì„¸ì •ë³´
            </div>
            <h2 class="page-title-large">ì‚¬ìš©ì ìƒì„¸ì •ë³´</h2>
        </div>
        <div>
            <a href="/api/admin/users" class="btn btn-secondary">ëª©ë¡ìœ¼ë¡œ</a>
        </div>
    </div>

    <!-- Main Content -->
    <div layout:fragment="content">
        <!-- ì•Œë¦¼ ë©”ì‹œì§€ -->
        <div th:if="${param.success}" class="alert alert-success">
            ì‚¬ìš©ì ì •ë³´ê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.
        </div>
        <div th:if="${param.error}" class="alert alert-danger">
            <span th:text="${param.error}">ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</span>
        </div>

        <!-- ëª¨ë“œ ì„ íƒ ë²„íŠ¼ -->
        <div class="user-mode-selector">
            <button id="viewMode" class="user-mode-btn active" onclick="toggleMode('view')">ğŸ‘ï¸ ë³´ê¸° ëª¨ë“œ</button>
            <button id="editMode" class="user-mode-btn" onclick="toggleMode('edit')">âœï¸ ìˆ˜ì • ëª¨ë“œ</button>
        </div>

        <!-- ì‚¬ìš©ì ì •ë³´ (ì½ê¸° ì „ìš©) -->
        <div class="detail-card" id="viewSection">
            <div class="detail-card-header">
                <h3>ğŸ‘¤ ì‚¬ìš©ì ì •ë³´</h3>
            </div>
            <div class="detail-card-body">
                <div class="user-detail-grid">
                    <div class="user-detail-label">ì‚¬ìš©ì ID</div>
                    <div class="user-detail-value" th:text="${user.userId}">1</div>

                    <div class="user-detail-label">ì´ë¦„</div>
                    <div class="user-detail-value user-name" th:text="${user.userName}">ì‚¬ìš©ìëª…</div>

                    <div class="user-detail-label">ë‹‰ë„¤ì„</div>
                    <div class="user-detail-value" th:text="${user.userNickname}">ë‹‰ë„¤ì„</div>

                    <div class="user-detail-label">ì´ë©”ì¼</div>
                    <div class="user-detail-value email-display" th:text="${user.userEmail}">ì´ë©”ì¼</div>

                    <div class="user-detail-label">ì—­í• </div>
                    <div class="user-detail-value">
                        <span th:class="${user.admin ? 'role-badge admin-role' : 'role-badge user-role'}"
                              th:text="${user.userRoleName}">ì—­í• </span>
                    </div>

                    <div class="user-detail-label">ì£¼ì†Œ</div>
                    <div class="user-detail-value" th:text="${user.userAddress ?: 'ì •ë³´ ì—†ìŒ'}">ì£¼ì†Œ</div>

                    <div class="user-detail-label">ì—°ë½ì²˜</div>
                    <div class="user-detail-value" th:text="${user.userPhone ?: 'ì •ë³´ ì—†ìŒ'}">ì—°ë½ì²˜</div>

                    <div class="user-detail-label">ì†Œì…œ ë¡œê·¸ì¸</div>
                    <div class="user-detail-value" th:text="${user.socialProvider ?: 'ì¼ë°˜ íšŒì›'}">ì†Œì…œ ë¡œê·¸ì¸</div>

                    <div class="user-detail-label">ì†Œì…œ ID</div>
                    <div class="user-detail-value" th:text="${user.socialId ?: '-'}">ì†Œì…œ ID</div>

                    <div class="user-detail-label">ì•½ê´€ ë™ì˜</div>
                    <div class="user-detail-value">
                        <span th:class="${user.termsAgreed != null and user.termsAgreed ? 'status-badge status-active' : 'status-badge status-inactive'}"
                              th:text="${user.termsAgreed != null and user.termsAgreed ? 'ë™ì˜' : 'ë¯¸ë™ì˜'}">
                            ì•½ê´€ ë™ì˜
                        </span>
                    </div>

                    <div class="user-detail-label">ê°€ì…ì¼ì</div>
                    <div class="user-detail-value" th:text="${user.userCreatedAt != null ? #temporals.format(user.userCreatedAt, 'yyyy-MM-dd HH:mm') : '-'}">ê°€ì…ì¼ì</div>

                    <div class="user-detail-label">ìˆ˜ì •ì¼ì</div>
                    <div class="user-detail-value" th:text="${user.userUpdatedAt != null ? #temporals.format(user.userUpdatedAt, 'yyyy-MM-dd HH:mm') : '-'}">ìˆ˜ì •ì¼ì</div>
                </div>
            </div>
        </div>

        <!-- ì‚¬ìš©ì ìˆ˜ì • í¼ -->
        <div class="detail-card hidden" id="editSection">
            <div class="detail-card-header">
                <h3>âœï¸ ì‚¬ìš©ì ì •ë³´ ìˆ˜ì •</h3>
            </div>
            <div class="detail-card-body">
                <form th:action="@{/api/admin/users/{userId}/update(userId=${user.userId})}" method="post" class="user-form">
                    <div class="user-form-row">
                        <div class="user-form-group">
                            <label for="userName" class="required">ì´ë¦„ *</label>
                            <input type="text" id="userName" name="userName" th:value="${user.userName}"
                                   class="user-form-control" required maxlength="50"
                                   placeholder="ì‚¬ìš©ì ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
                            <small class="user-form-text">í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤. (ìµœëŒ€ 50ì)</small>
                        </div>

                        <div class="user-form-group">
                            <label for="userNickname" class="required">ë‹‰ë„¤ì„ *</label>
                            <input type="text" id="userNickname" name="userNickname" th:value="${user.userNickname}"
                                   class="user-form-control" required maxlength="20"
                                   placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”">
                            <small class="user-form-text">í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤. (ìµœëŒ€ 20ì)</small>
                        </div>
                    </div>

                    <div class="user-form-row">
                        <div class="user-form-group">
                            <label for="userEmail" class="required">ì´ë©”ì¼ *</label>
                            <input type="email" id="userEmail" name="userEmail" th:value="${user.userEmail}"
                                   class="user-form-control" required maxlength="255"
                                   placeholder="example@email.com">
                            <small class="user-form-text">í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤. ë¡œê·¸ì¸ IDë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.</small>
                        </div>

                        <div class="user-form-group">
                            <label for="userPhone">ì—°ë½ì²˜</label>
                            <input type="tel" id="userPhone" name="userPhone" th:value="${user.userPhone}"
                                   class="user-form-control" maxlength="20"
                                   placeholder="010-0000-0000">
                            <small class="user-form-text">íœ´ëŒ€í° ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</small>
                        </div>
                    </div>

                    <div class="user-form-row">
                        <div class="user-form-group">
                            <label for="userAddress">ì£¼ì†Œ</label>
                            <textarea id="userAddress" name="userAddress" th:text="${user.userAddress}"
                                      class="user-form-control" rows="3" maxlength="200"
                                      placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                            <small class="user-form-text">ì‚¬ìš©ìì˜ ì£¼ì†Œ ì •ë³´ì…ë‹ˆë‹¤. (ìµœëŒ€ 200ì)</small>
                        </div>

                        <div class="user-form-group">
                            <label for="userRoleId" class="required">ì—­í•  *</label>
                            <select id="userRoleId" name="userRoleId" class="user-form-control" required>
                                <option value="">ì—­í• ì„ ì„ íƒí•˜ì„¸ìš”</option>
                                <option th:each="role : ${roles}"
                                        th:value="${role.userRoleId}"
                                        th:text="${role.userRoleName}"
                                        th:selected="${role.userRoleId == user.userRoleId}">
                                    ì—­í• ëª…
                                </option>
                            </select>
                            <small class="user-form-text">ì‚¬ìš©ìì˜ ê¶Œí•œ ì—­í• ì„ ì„¤ì •í•©ë‹ˆë‹¤.</small>
                        </div>
                    </div>

                    <div class="user-form-row">
                        <div class="user-form-group">
                            <label for="termsAgreed" class="required">ì•½ê´€ ë™ì˜ ìƒíƒœ *</label>
                            <select id="termsAgreed" name="termsAgreed" class="user-form-control" required>
                                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="true" th:selected="${user.termsAgreed == true}">ë™ì˜</option>
                                <option value="false" th:selected="${user.termsAgreed == false}">ë¯¸ë™ì˜</option>
                            </select>
                            <small class="user-form-text">ì‚¬ìš©ìì˜ ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€ ë™ì˜ ìƒíƒœë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.</small>
                        </div>
                    </div>

                    <div class="user-form-actions">
                        <button type="submit" class="btn btn-primary">
                            <i class="icon">ğŸ’¾</i> ìˆ˜ì • ì €ì¥
                        </button>
                        <button type="button" class="btn btn-danger" onclick="deleteUser()">
                            <i class="icon">ğŸ—‘ï¸</i> ì‚¬ìš©ì ì‚­ì œ
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="toggleMode('view')">
                            <i class="icon">âŒ</i> ì·¨ì†Œ
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- ì½ê¸° ì „ìš© ëª¨ë“œ ë©”ì‹œì§€ -->
        <div class="user-readonly-message" id="readonlyMessage">
            <div class="readonly-icon">ğŸ‘ï¸</div>
            <div class="readonly-text">
                <strong>ì½ê¸° ì „ìš© ëª¨ë“œ</strong><br>
                í˜„ì¬ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤. ìˆ˜ì •ì´ í•„ìš”í•œ ê²½ìš° 'ìˆ˜ì • ëª¨ë“œ'ë¡œ ì „í™˜í•˜ì„¸ìš”.
            </div>
        </div>
    </div>


    <th:block layout:fragment="extra-scripts">
        <script>
            function toggleMode(mode) {
                const viewBtn = document.getElementById('viewMode');
                const editBtn = document.getElementById('editMode');
                const viewSection = document.getElementById('viewSection');
                const editSection = document.getElementById('editSection');
                const readonlyMessage = document.getElementById('readonlyMessage');

                if (mode === 'view') {
                    viewBtn.classList.add('active');
                    editBtn.classList.remove('active');
                    viewSection.style.display = 'block';
                    editSection.classList.add('hidden');
                    readonlyMessage.style.display = 'flex';
                } else {
                    editBtn.classList.add('active');
                    viewBtn.classList.remove('active');
                    viewSection.style.display = 'none';
                    editSection.classList.remove('hidden');
                    readonlyMessage.style.display = 'none';
                }
            }

            function deleteUser() {
                if (confirm('ì •ë§ë¡œ ì´ ì‚¬ìš©ìë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì‚­ì œëœ ë°ì´í„°ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                    const form = document.createElement('form');
                    form.method = 'POST';
                    form.action = '/api/admin/users/' + [[${user.userId}]] + '/delete';
                    document.body.appendChild(form);
                    form.submit();
                }
            }
        </script>
    </th:block>
</body>
</html>