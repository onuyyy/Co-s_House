<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:replace="fragments/layout :: head('장바구니 | 코딩의 집')"></th:block>
    <link rel="stylesheet" th:href="@{/css/cart.css}">
</head>
<body class="page font-body">
<header th:replace="fragments/layout :: header"></header>

<main class="main-content">
    <div class="page-card">
        <div class="cart-layout">
            <!-- Main Content -->
            <section class="items-card" aria-labelledby="cart-items-title">
                <div class="section-head">
                    <h2 id="cart-items-title">담긴 상품</h2>
                    <span id="cart-count" class="count-badge">0</span>
                </div>

                <!-- Item Actions -->
                <div class="item-actions" id="item-actions" hidden>
                    <button class="action-btn" id="select-all-btn">전체 선택</button>
                    <button class="action-btn" id="deselect-all-btn">전체 해제</button>
                    <button class="action-btn danger" id="remove-selected-btn">선택 삭제</button>
                </div>

                <!-- Loading State -->
                <div class="loading" id="cart-loading">
                    <div class="spinner"></div>
                </div>

                <!-- Empty State -->
                <div id="cart-empty" class="empty-state" hidden>
                    <div class="empty-icon">🛒</div>
                    <h3>장바구니가 비어있어요</h3>
                    <p>마음에 드는 상품을 담아보세요!</p>
                    <br>
                    <a href="/product" style="color: var(#ffffff); text-decoration: none; font-weight: 600;">
                        상품 둘러보기
                    </a>
                </div>

                <!-- Guest Info -->
                <div id="guest-info" class="info" hidden>
                    <strong>로그인하고 상품을 구매하세요!</strong><br>
                    보유 쿠폰 자동 적용, 적립금 사용, 배송지 관리 등의 기능을 이용하실 수 있어요.
                </div>

                <!-- Item List -->
                <ul id="cart-item-list" class="item-list" aria-live="polite"></ul>

                <!-- Error States -->
                <div id="cart-error" class="alert" hidden>
                    장바구니를 불러오지 못했습니다. 새로고침 후 다시 시도해주세요.
                </div>
                <div id="cart-unauth" class="alert" hidden>
                    로그인이 필요한 서비스입니다. 로그인 후 장바구니를 확인해주세요.
                </div>
            </section>

            <!-- Summary Sidebar -->
            <aside class="summary-card" aria-labelledby="cart-preview-title">
                <h2 id="cart-preview-title">💰 주문 요약</h2>
                <dl class="summary-list">
                    <div>
                        <dt>총 상품 수량</dt>
                        <dd><span id="summary-quantity">0</span>개</dd>
                    </div>
                    <div>
                        <dt>상품 금액</dt>
                        <dd><span id="summary-total">0</span>원</dd>
                    </div>
                    <div>
                        <dt>배송비</dt>
                        <dd><span id="summary-shipping">0</span>원</dd>
                    </div>
                    <div>
                        <dt>할인 금액</dt>
                        <dd style="color: var(--success-color);">-<span id="summary-discount">0</span>원</dd>
                    </div>
                    <div class="em">
                        <dt>최종 결제 금액</dt>
                        <dd><span id="summary-expected">0</span>원</dd>
                    </div>
                </dl>

                <button class="checkout-btn" id="checkout-button" disabled>
                    주문하기
                </button>

                <p class="summary-tip">
                    💡 <strong>쿠폰 혜택:</strong> 브랜드별 최적 쿠폰이 자동 적용됩니다.
                    50,000원 이상 구매 시 무료배송!
                </p>
            </aside>
        </div>
    </div>
</main>

<div id="cart-option-modal" class="cart-option-modal" hidden>
    <div class="cart-option-modal__overlay" id="cart-option-overlay"></div>
    <div class="cart-option-modal__panel" role="dialog" aria-modal="true" aria-labelledby="cart-option-modal-title">
        <header class="cart-option-modal__header">
            <h2 id="cart-option-modal-title">옵션 변경</h2>
            <button type="button" class="cart-option-modal__close" id="cart-option-close" aria-label="옵션 변경 창 닫기">×</button>
        </header>
        <div class="cart-option-modal__body">
            <p class="cart-option-modal__product" id="cart-option-product-title"></p>
            <label for="cart-option-select" class="cart-option-modal__label">옵션 선택</label>
            <select id="cart-option-select" class="cart-option-modal__select"></select>
            <p id="cart-option-empty-message" class="cart-option-modal__empty" hidden>선택 가능한 옵션이 없습니다.</p>
        </div>
        <footer class="cart-option-modal__actions">
            <button type="button" class="btn btn-outline" id="cart-option-cancel">취소</button>
            <button type="button" class="btn" id="cart-option-save">저장</button>
        </footer>
    </div>
</div>

<footer th:replace="fragments/layout :: footer"></footer>

<script defer th:src="@{/js/cart.js}"></script>
</body>
</html>
