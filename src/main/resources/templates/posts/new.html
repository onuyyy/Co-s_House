<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/layout :: head('오늘의 집 | 게시글 작성')"></head>
<body class="page font-body">
<header th:replace="fragments/layout :: header"></header>
<main class="page-main">
    <div class="container-write">
        <section class="post-write-container">
            <h1 class="post-write-title">코딩의 집</h1>
            
            <form id="postForm" th:action="@{/posts/new}" method="post" enctype="multipart/form-data">
                <!-- 집들이 작성 가이드 -->
                <div class="guide-box">
                    <div class="guide-header">
                        <span class="guide-icon">📝</span>
                        <strong>집들이 작성 가이드</strong>
                        <span class="guide-subtitle">원활한 집들이 발행을 위해 꼭 읽어주세요.</span>
                        <button type="button" class="guide-toggle">▲</button>
                    </div>
                    <div class="guide-content" th:if="${postInformation != null}">
                        <ul class="guide-list">
                            <li th:each="info : ${postInformation}" th:text="${info.codeName}"></li>
                        </ul>
                    </div>
                </div>

                <!-- 필수 정보 입력 -->
                <div class="required-info-box">
                    <div class="required-info-header">
                        <span class="required-icon">✏️</span>
                        <strong>필수 정보 입력</strong>
                        <span class="required-subtitle">공간을 이해하는데 필요한 정보이니 최대한 꼼꼼하게 입력해주세요.</span>
                        <button type="button" class="required-toggle">▲</button>
                    </div>
                    <div class="required-info-content">
                        <!-- 주거형태 -->
                        <div class="form-group">
                            <label class="form-label required">주거형태 *</label>
                            <select name="housingType" class="form-select" required>
                                <option value="">선택해주세요</option>
                                <option th:each="option : ${housingTypes}" 
                                        th:value="${option.displayName}" 
                                        th:text="${option.displayName}"></option>
                            </select>
                        </div>

                        <!-- 평수 -->
                        <div class="form-group">
                            <label class="form-label">평수</label>
                            <input type="number" name="areaSize" class="form-input" placeholder="평수를 입력해주세요" min="1">
                        </div>

                        <!-- 방 개수 -->
                        <div class="form-group">
                            <label class="form-label">방 개수</label>
                            <input type="number" name="roomCount" class="form-input" placeholder="방 개수를 입력해주세요" min="1">
                        </div>

                        <!-- 가족형태 -->
                        <div class="form-group">
                            <label class="form-label">가족형태</label>
                            <select name="familyType" class="form-select">
                                <option value="">선택해주세요</option>
                                <option th:each="option : ${familyTypes}" 
                                        th:value="${option.displayName}" 
                                        th:text="${option.displayName}"></option>
                            </select>
                        </div>

                        <!-- 가족 구성원 수 -->
                        <div class="form-group">
                            <label class="form-label">가족 구성원 수</label>
                            <input type="number" name="familyCount" class="form-input" placeholder="가족 구성원 수를 입력해주세요" min="1">
                        </div>

                        <!-- 반려동물 유무 -->
                        <div class="form-group">
                            <label class="form-label">반려동물</label>
                            <div class="radio-group">
                                <label class="radio-label">
                                    <input type="radio" name="hasPet" value="true"> 있음
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="hasPet" value="false"> 없음
                                </label>
                            </div>
                        </div>

                        <!-- 작업 분야 -->
                        <div class="form-group">
                            <label class="form-label">작업 분야</label>
                            <select name="projectType" class="form-select">
                                <option value="">선택해주세요</option>
                                <option th:each="option : ${projectTypes}" 
                                        th:value="${option.displayName}" 
                                        th:text="${option.displayName}"></option>
                            </select>
                        </div>

                        <!-- 공개여부 -->
                        <div class="form-group">
                            <label class="form-label">공개여부</label>
                            <div class="radio-group">
                                <label class="radio-label">
                                    <input type="radio" name="isPublic" value="true" checked> 공개
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="isPublic" value="false"> 비공개
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 제목 -->
                <div class="form-group">
                    <label class="form-label required">제목 *</label>
                    <input type="text" name="title" class="form-input" placeholder="제목을 입력해주세요" required maxlength="100">
                </div>

                <!-- 내용 -->
                <div class="form-group">
                    <label class="form-label required">내용 *</label>
                    <textarea name="content" class="form-textarea" placeholder="내용을 입력해주세요" required rows="10"></textarea>
                </div>

                <!-- 이미지 업로드 -->
                <div class="form-group">
                    <label class="form-label">사진 업로드</label>
                    <div class="image-upload-box">
                        <input type="file" id="imageUpload" name="images" multiple accept="image/jpeg,image/jpg,image/png,image/webp,image/heif,image/heic,image/gif" style="display: none;">
                        <label for="imageUpload" class="image-upload-label">
                            <span>드래그 앤 드롭하거나 추가하기 버튼으로<br>사진을 업로드해주세요.</span>
                            <button type="button" class="btn-upload" onclick="document.getElementById('imageUpload').click();">사진 추가하기</button>
                        </label>
                        <div class="image-upload-info">
                            <p>*권장 사이즈</p>
                            <p>모바일: 1920 x 1920, 최소 1400 x 1400(1:1 비율)</p>
                            <p>PC: 1920 x 1080, 최소 1400 x 787(16:9 비율)</p>
                        </div>
                    </div>
                    <div id="imagePreview" class="image-preview-container"></div>
                    <p class="form-help-text">사진 첨부 시 용량은 장당 최대 20MB까지 업로드할 수 있고, jpg, png, webp, heif, heic, gif 포맷을 지원합니다.</p>
                </div>

                <!-- 상품 추가 -->
                <div class="form-group">
                    <label class="form-label">사용한 상품</label>
                    <button type="button" class="btn-add-product" onclick="openProductModal()">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <path d="M10 5v10M5 10h10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        상품 추가하기
                    </button>
                    <div id="selectedProducts" class="selected-products-container"></div>
                </div>

                <!-- 버튼 -->
                <div class="form-actions">
                    <button type="button" class="btn-cancel" onclick="history.back()">발행취소</button>
                    <button type="submit" class="btn-submit">게시글 작성</button>
                </div>
            </form>
        </section>
    </div>
</main>

<!-- 상품 선택 모달 -->
<div id="productModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>사용한 상품 선택</h2>
            <button type="button" class="modal-close" onclick="closeProductModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div id="productList" class="product-list">
                <p class="loading">상품을 불러오는 중...</p>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn-modal-cancel" onclick="closeProductModal()">취소</button>
            <button type="button" class="btn-modal-confirm" onclick="confirmProductSelection()">선택 완료</button>
        </div>
    </div>
</div>

<footer th:replace="fragments/layout :: footer"></footer>
<link rel="stylesheet" th:href="@{/css/post-write.css}">
<script th:src="@{/js/post-write.js}"></script>
</body>
</html>