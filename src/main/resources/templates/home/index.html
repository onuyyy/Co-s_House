<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/layout :: head('코딩의 집 | 홈')}"></head>
<body class="page font-body">
  <header th:replace="~{fragments/layout :: header}"></header>

  <main class="page-main">
    <!-- Top hero -->
    <section class="home-hero">
      <div class="container hero-inner">
        <div class="hero-copy">
          <span class="hero-eyebrow">코딩의 집</span>
          <h1 class="hero-title">오늘, 우리 집 분위기를 바꾸다</h1>
          <p class="hero-sub">햇살이 머무는 거실에서 영감 받은 최신 가구와 리빙 소품을 만나보세요.</p>
          <a class="btn hero-cta" th:href="@{/product}">상품 둘러보기</a>
        </div>
        <figure class="hero-visual">
          <img class="hero-image" th:src="@{/images/home.jpeg}" alt="햇살이 들어오는 거실과 원목 가구" loading="lazy" />
        </figure>
      </div>
    </section>

    <!-- Category chips removed as requested -->

    <!-- Today deal -->
    <section id="today" class="section container">
      <div class="section-head">
        <h2 class="text-h2">오늘의 딜</h2>
        <a class="link-more" th:href="@{/deal/today}">더보기</a>
      </div>
      <div class="product-grid grid-4 today-deals" th:with="dealCount=${todayDeals != null ? todayDeals.size() : 0}, displayCount=${dealCount > 4 ? 4 : dealCount}">
        <article class="p-card" th:each="p, iterStat : ${todayDeals}" th:if="${iterStat.index < 4}">
          <a class="thumb" th:href="@{'/product/' + ${p.id}}">
            <img th:if="${p.imageUrl != null}" th:src="${p.imageUrl}" th:alt="${p.title}" loading="lazy" />
            <div class="ph" th:unless="${p.imageUrl != null}" role="img" aria-label="상품 이미지 플레이스홀더"></div>
            <span class="ribbon" th:if="${p.discountRate != null}" th:text="${'-' + #numbers.formatDecimal(p.discountRate, 0, 0) + '%'}">-20%</span>
          </a>
          <div class="body">
            <h3 class="title" th:text="${p.title}">상품명</h3>
            <div class="price">
              <b th:text="${#numbers.formatDecimal(p.salePrice != null ? p.salePrice : p.price, 0, 'COMMA', 0, 'POINT')}">0</b><span class="unit">원</span>
            </div>
            <div class="meta">
              <span class="rating" th:text="${'★ ' + (p.rating != null ? p.rating : 0)}">★ 0</span>
              <span class="count" th:text="${'후기 ' + (p.reviewCount != null ? p.reviewCount : 0)}">후기 0</span>
            </div>
          </div>
        </article>
        <article class="p-card placeholder" th:if="${displayCount < 4}" th:each="i : ${#numbers.sequence(1, 4 - displayCount)}">
          <div class="placeholder-body">
            <span class="label">곧 업데이트</span>
            <p>신규 딜이 준비되고 있어요.</p>
          </div>
        </article>
      </div>
    </section>

    <!-- Popular products -->
    <section id="popular" class="section container section--spaced">
      <div class="section-head">
        <h2 class="text-h2">인기 급상승</h2>
        <a class="link-more" th:href="@{/product}">더보기</a>
      </div>
      <div class="product-grid grid-4">
        <article class="p-card small" th:each="p : ${popularProducts}">
          <a class="thumb" th:href="@{'/product/' + ${p.id}}">
            <img th:if="${p.imageUrl != null}" th:src="${p.imageUrl}" th:alt="${p.title}" loading="lazy" />
            <div class="ph" th:unless="${p.imageUrl != null}" role="img" aria-label="상품 이미지 플레이스홀더"></div>
          </a>
          <div class="body">
            <h3 class="title" th:text="${p.title}">상품명</h3>
            <div class="price"><b th:text="${#numbers.formatDecimal(p.salePrice != null ? p.salePrice : p.price, 0, 'COMMA', 0, 'POINT')}">0</b><span class="unit">원</span></div>
          </div>
        </article>
      </div>
    </section>

    <!-- Room tour / Community -->
    <section id="roomtour" class="section container section--spaced">
      <div class="section-head">
        <h2 class="text-h2">집들이</h2>
        <a class="link-more" th:href="@{/posts}">더보기</a>
      </div>
      <div class="community-grid" th:with="postCount=${topPosts != null ? topPosts.size() : 0}, displayPosts=${postCount > 4 ? 4 : postCount}">
        <article class="community-card" th:each="post, iterStat : ${topPosts}" th:if="${iterStat.index < 4}">
          <a class="thumb" th:href="@{'/community/' + ${post.id}}">
            <div class="ph" role="img" aria-label="집들이 이미지 플레이스홀더"></div>
          </a>
          <div class="body">
            <div class="meta-top">
              <span class="category">오늘의 집들이</span>
            </div>
            <h3 class="title" th:text="${post.title}">집들이 제목</h3>
            <p class="excerpt">커뮤니티에서 실제 집꾸미기 이야기를 만나보세요.</p>
            <div class="meta-bottom">
              <span class="stat" th:text="${'좋아요 ' + (post.likeCount != null ? post.likeCount : 0)}">좋아요 0</span>
              <span class="dot">·</span>
              <span class="stat" th:text="${'댓글 ' + (post.commentCount != null ? post.commentCount : 0)}">댓글 0</span>
            </div>
          </div>
        </article>

        <article class="community-card placeholder" th:if="${displayPosts < 4}" th:each="i : ${#numbers.sequence(1, 4 - displayPosts)}">
          <div class="thumb">
            <div class="ph" role="img" aria-label="커뮤니티 플레이스홀더"></div>
          </div>
          <div class="body">
            <div class="meta-top">
              <span class="category">집들이 대기 중</span>
            </div>
            <h3 class="title">곧 새로운 스토리가 올라올 예정입니다.</h3>
            <p class="excerpt">커뮤니티에서 공간을 공유하면 홈 피드에 소개되는 기회가 있어요.</p>
            <a class="link-more" th:href="@{/templates/posts}">커뮤니티 둘러보기</a>
          </div>
        </article>
      </div>
    </section>

    <!-- Banner / events -->
    <section id="events" class="section container section--spaced">
      <div class="event-slider" data-event-slider
           th:if="${highlightEvents != null and !highlightEvents.isEmpty()}"
           th:with="eventBg=${highlightEvents != null and !highlightEvents.isEmpty() and highlightEvents.get(0).imageUrl() != null
                          ? highlightEvents.get(0).imageUrl()
                          : null}">
        <button type="button" class="event-nav event-nav--prev" data-event-prev aria-label="이전 이벤트">‹</button>
        <div class="event-viewport"
             th:attr="style=${eventBg} != null ? '--event-viewport-bg: url(' + eventBg + ')' : null">
            <div class="event-track" data-event-track>
              <article class="event-slide"
                       th:each="event, iterStat : ${highlightEvents}"
                       th:attr="data-index=${iterStat.index}"
                       th:with="imageUrl=${event.imageUrl()}">
                <a class="event-banner"
                   th:href="${event.linkUrl()}"
                   th:attr="aria-label=${event.title()}"
                   th:style="|background-image: url(${imageUrl});|">
                  <span class="sr-only" th:text="${event.title()}">이벤트 보기</span>
                </a>
              </article>
            </div>
          </div>
        <button type="button" class="event-nav event-nav--next" data-event-next aria-label="다음 이벤트">›</button>
        <div class="event-dots" aria-label="이벤트 이동">
          <button type="button" class="event-dot" th:each="event, iterStat : ${highlightEvents}" th:attr="data-event-dot=${iterStat.index}" aria-label="이벤트 보기"></button>
        </div>
      </div>
      <div class="banner" th:if="${highlightEvents == null or highlightEvents.isEmpty()}">
        <div class="banner-text">
          <div class="eyebrow">이벤트</div>
          <h3>가을맞이 리빙페어</h3>
          <p>브랜드 단독 특가와 10% 쿠폰</p>
          <a class="btn btn-outline" th:href="@{/events/fall}">자세히 보기</a>
        </div>
        <div class="banner-img">
          <div class="ph ph-banner" role="img" aria-label="프로모션 이미지 플레이스홀더"></div>
        </div>
      </div>
    </section>
  </main>

  <footer th:replace="~{fragments/layout :: footer}"></footer>

  <link rel="stylesheet" th:href="@{/css/sections.css}">
  <link rel="stylesheet" th:href="@{/css/home.css}">
  <script defer th:src="@{/js/home.js}"></script>
</body>
</html>
